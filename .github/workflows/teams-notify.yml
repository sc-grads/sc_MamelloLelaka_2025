name: Teams Pull Requests
on:
  pull_request:
    types: [opened, reopened, synchronize, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Adaptive Card to Teams
        run: |
          curl -X POST \
               -H "Content-Type: application/json" \
               -d '{
                 "type": "message",
                 "attachments": [
                   {
                     "contentType": "application/vnd.microsoft.card.adaptive",
                     "content": {
                       "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                       "version": "1.3",
                       "type": "AdaptiveCard",
                       "body": [
                         {
                           "type": "TextBlock",
                           "text": "${{ github.event.pull_request.user.login }}'s Merge Confirmation ðŸŽ‰",
                           "size": "Large",
                           "weight": "Bolder",
                           "color": "Accent"
                         },
                         {
                           "type": "TextBlock",
                           "text": "Status: ${{ github.event.pull_request.merged ? 'Merged' : github.event.pull_request.draft ? 'Draft' : github.event.pull_request.state }}   Actor: ${{ github.actor }}",
                           "wrap": true
                         },
                         {
                           "type": "TextBlock",
                           "text": "âœ… **Merge Confirmation** ------------------------------- ðŸš€ **PR Details**",
                           "wrap": true
                         },
                         {
                           "type": "TextBlock",
                           "text": "**Title**: ${{ github.event.pull_request.title }}\n**Description**: ${{ github.event.pull_request.body }}",
                           "wrap": true
                         },
                         {
                           "type": "TextBlock",
                           "text": "ðŸ”§ **Action Summary**\n**Author**: ${{ github.event.pull_request.user.login }}\n**Approved By**: Unknown",
                           "wrap": true
                         },
                         {
                           "type": "TextBlock",
                           "text": "ðŸ“‹ **Branch Information**\n**Source Branch**: ${{ github.event.pull_request.head.ref }}\n**Target Branch**: ${{ github.event.pull_request.base.ref }}",
                           "wrap": true
                         },
                         {
                           "type": "ActionSet",
                           "actions": [
                             {
                               "type": "Action.OpenUrl",
                               "title": "View PR",
                               "url": "${{ github.event.pull_request.html_url }}"
                             }
                           ]
                         }
                       ],
                       "actions": [
                         {
                           "type": "Action.OpenUrl",
                           "title": "View run",
                           "url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                         },
                         {
                           "type": "Action.OpenUrl",
                           "title": "View commit",
                           "url": "${{ github.event.pull_request.head.repo.html_url }}/commit/${{ github.event.pull_request.head.sha }}"
                         }
                       ]
                     }
                   }
                 ]
               }' \
               ${{ secrets.TEAMS_WEBHOOK_URL }}
