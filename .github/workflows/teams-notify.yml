name: Notify Teams on PR Events
on:
  pull_request:
    types: [opened, reopened, synchronize, closed]
  pull_request_review:
    types: [submitted]
jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # 1. Notify when a pull request is created, reopened, or updated (but not closed)
      - name: Notify on PR creation/update
        if: ${{ github.event_name == 'pull_request' && github.event.action != 'closed' }}
        run: |
          curl -H "Content-Type: application/json" -d '{
            "text": "New Pull Request: #${{ github.event.pull_request.number }} opened by ${{ github.event.pull_request.user.login }}.\nTitle: ${{ github.event.pull_request.title }}\nLink: ${{ github.event.pull_request.html_url }}"
          }' ${{ secrets.TEAMS_INCOMING_WEBHOOK_URL }}
      
      # 2. Notify when a pull request review is submitted with an approval
      - name: Notify on PR approval
        if: ${{ github.event_name == 'pull_request_review' && github.event.review.state == 'approved' }}
        run: |
          curl -H "Content-Type: application/json" -d '{
            "text": "Pull Request: #${{ github.event.pull_request.number }} has been APPROVED by ${{ github.event.review.user.login }}.\nLink: ${{ github.event.pull_request.html_url }}"
          }' ${{ secrets.TEAMS_INCOMING_WEBHOOK_URL }}
      
      # 3. Notify when a pull request is merged (closed and merged)
      - name: Notify on PR merge
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true }}
        run: |
          curl -H "Content-Type: application/json" -d '{
            "text": "A pull request has been successfully merged!\n\n*Repository:* ${{ github.repository }}\n*PR Title:* ${{ github.event.pull_request.title }}\n*Merged by:* ${{ github.event.pull_request.merged_by.login }}\n[View PR](${{ github.event.pull_request.html_url }})"
          }' ${{ secrets.TEAMS_INCOMING_WEBHOOK_URL }}
